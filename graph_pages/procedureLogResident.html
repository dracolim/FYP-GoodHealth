<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Links -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.3/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.2/iconify-icon.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/xlsx@0.14.3/dist/xlsx.full.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datasource@0.1.0"></script>

    <!-- VUE 3 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Testing Mon Method -->
    <script src="https://cdn.jsdelivr.net/npm/babel-regenerator-runtime@6.5.0/runtime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-polyfill/dist/polyfill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.0.10/dist/vuetify.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script src="https://unpkg.com/vue-chartjs@3.4.0/dist/vue-chartjs.js"></script>

    <title>SingHealth</title>
</head>

<body>

    <div id="main-container">
        
        <!-- header -->
        <div class="bg-stone-100 border-gray-200 px-2 sm:px-4 py-2.5 rounded ">
            <div class="container flex flex-wrap items-center justify-between mx-auto" style="width: 100%; overflow: hidden;">
                <img src="../images/SingHealth_Logo.png" class="mr-3 sm:h-15 ml-3 mt-2 mb-2"
                    style="height: 80px ; width: 100px;" alt="Flowbite Logo" />

                <div class="flex md:order-2">
                    <a href="homepage.html" style="margin-right: 10px;">
                        <iconify-icon icon="ic:round-home" style="color: #ff6b00;" width="40" height="40"></iconify-icon>
                    </a>
                    <a>
                        <iconify-icon icon="healthicons:ui-user-profile" style="color: #ff6b00;" width="40" height="40">
                        </iconify-icon>
                    </a>

                    <button data-collapse-toggle="navbar-sticky" type="button"
                        class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 "
                        aria-controls="navbar-cta" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Navbar -->
        <nav class="bg-white">
            <div class="items-center justify-between hidden w-full md:flex md:width-auto  md:order-1" id="navbar-sticky" style="width: 100%; overflow: hidden;">
                <ul class="md:divide-x md:divide-slate-200 flex flex-col p-2 border border-gray-100 rounded-lg bg-gray-50 md:flex-row  md:mt-0 md:text-sm md:font-medium md:border-0 md:bg-white">
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs mr-2 ml-4 lg:ml-10 block py-2 pl-3 pr-2 text-white bg-orange-500 rounded md:bg-transparent md:text-orange-500 md:p-0 dark:text-white"
                            aria-current="page">Resident Profiles</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs ml-5 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">
                            History</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs ml-5 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">
                            Involvement</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs  ml-5 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">
                            Grants</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs  ml-5 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">
                            Publications</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs  ml-6 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">Presentations</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs  ml-6 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">
                            Awards</a>
                    </li>
                    <li>
                        <a href="#"
                            class="lg:text-sm md:text-xs  ml-6 mr-4 block py-2 pl-3 pr-4 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-orange-500 md:p-0">Projects</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Orange Divider -->
        <div class='row' style='height: 8px; background-color: #ff6b00;'></div>

        <!-- Graph Goes Here -->
        <div class="container mx-auto pt-4" >

            <div id="app">

                <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="grid-first-name">
                    MCR No:
                </label>

                <input v-model="mcr_no" class="appearance-none block w-full bg-gray-200 text-gray-700 border border-red-500 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white" id="grid-first-name" type="text" placeholder="Input MCR No Here">

                <button @click="getSpecificProcedureLogData()" class="bg-[#ea580c] hover:bg-[#292524] text-white font-bold py-2 px-4 rounded">
                    Get Resident's Info
                </button> 

                <v-row dense>
                  <v-col cols="sm">
                    <v-card class="pa-2" outlined tile raised>
                      <my-bar-chart v-if="loaded" :bar-data="ChartConfig" :chart-options="options"></my-bar-chart>
                    </v-card>
                  </v-col>
                </v-row>

            </div>

        </div>

    </div>

    <!--- JAVASCRIPT -->
    <script>

        Vue.component('my-bar-chart', {
            extends: VueChartJs.HorizontalBar,
            props: ['barData', 'chartOptions'],
            mounted() {
            this.renderChart(this.barData, this.chartOptions);
            },
        }, {
            responsive: true,
            maintainAspectRatio: false
        })

        new Vue({
            el: "#app",
            vuetify: new Vuetify(),
            data() {
            return {
                year: null,
                loaded: false,
                ChartConfig: {
                labels: ["Jan-Jun", "Jul-Dec"],
                datasets: [
                    {
                    data: [],
                    backgroundColor: '#ff6b00',
                    borderColor: 'rgba(136,136,136,0.5)',
                    label: "Compliance Level"
                    }
                ]
                },
                options: {
                responsive: true,
                maintainAspectRatio: false,
                title: {
                    display: true,
                    text: 'Procedure Log (Resident)'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                    ticks : {
                    max : 1,    
                    min : 0
                    },
                    display: true,
                    categoryPercentage: 0.5,
                    scaleLabel: {
                        display: true,
                        labelString: 'Percentage of Compliance'
                    }
                    }],
                    yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Procedure Name'
                        
                    }
                    }]
                }
                },
            }
            },
            mounted: function () {
                this.loaded = false
                // this.getSpecificProcedureLogData();
                },
            methods: {
                getSpecificProcedureLogData: async function () {

                    this.status = "getting data...";

                    specificURL = "http://localhost:5011/profile/" + this.mcr_no
                    await axios.get(specificURL).then((response) => {
                    console.log("This is responseData")
                    console.log(response.data)
                
                    this.getChartData(response);
                    this.loaded = false
                    this.loaded = true
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
                },
                getChartData: function (chartData) {
                    console.log("This is PROCEDURE LOGS DATA")
                    console.log(chartData.data.data['procedure_logs']); //array of objects of that particular resident

                    year_of_training = chartData.data.data['personaldetails']['Year_of_Training'] // somehow need to make use of this to mark resident as compliant or not to reflect on front end if needed

                    if (chartData.data.data['personaldetails']['Programme'] == "Gastroenterology") {
                        console.log("Reached Gastro")
                        const Gastro = ["Gastroscopy (OGD)", "Gastroscopy (OGD) with biopsy", "Gastroscopy (OGD) with non-variceal hemostasis; not actively bleeding","Gastroscopy (OGD) with non-variceal hemostasis; actively bleeding", "Colonoscopy with non-variceal hemostasis; not actively bleeding", "Colonoscopy with non-variceal hemostasis; actively bleeding","Colonoscopy", "Colonoscopy with biopsy", "Colonoscopy with polypectomy","Abdominal paracentesis", "Capsule endoscopy", "Percutaneous Endoscopic Gastrostomy (PEG)","Gastroscopy with variceal hemostasis; active bleeding", "Gastroscopy with variceal hemostasis; not actively bleeding", "Gastroscopy with variceal ligation; elective eradication","Liver biopsy", "Esophageal dilatation", "Luminal Stenting","Endoscopic mucosal resection (EMR) / Endoscopic submucosal dissection (ESD)", "Endoscopic Retrograde and Cholangiocpancreatography (ERCP)", "Endoscopic ultrasound", "Esophageal motility / pH studies"]
                        this.ChartConfig.labels = Gastro

                        GastroOGDPlusGastroOGDWithBiopsy = 0
                        GastroOGDPlusColon = 0
                        ColonoscopyPlusColonoscopyWithBiopsy = 0
                        ColonoscopyWithPolypectomy = 0
                        AbdominalParacentesis = 0
                        CapsuleEndoscopy = 0
                        Peg = 0
                        GastroVaricealHemoPlusLigation = 0
                        LiverBiopsy = 0
                        EsophagealDilatationPlusLuminalStenting = 0
                        EmrPlusEsd = 0
                        Ercp = 0
                        EndoscopicUltrasound = 0
                        EsophagealMotilityPlusPh = 0

                        chartData.data.data['procedure_logs']

                    // POPULATING VARIABLES USING INFO FROM DATABASE

                        // for every procedure log entry
                        for (var i = 0; i < chartData.data.data['procedure_logs'].length; i++) {
                            procedure_name = chartData.data.data['procedure_logs'][i]['Procedure_Name']
                            if (procedure_name == Gastro[0] || procedure_name == Gastro[1]) {
                                GastroOGDPlusGastroOGDWithBiopsy = GastroOGDPlusGastroOGDWithBiopsy + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[2] || procedure_name == Gastro[3] || procedure_name == Gastro[4] || procedure_name == Gastro[5]) {
                                GastroOGDPlusColon = GastroOGDPlusColon + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[6] || procedure_name == Gastro[7]) {
                                ColonoscopyPlusColonoscopyWithBiopsy = ColonoscopyPlusColonoscopyWithBiopsy + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[8]) {
                                ColonoscopyWithPolypectomy = ColonoscopyWithPolypectomy + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[9]) {
                                AbdominalParacentesis = AbdominalParacentesis + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[10]) {
                                CapsuleEndoscopy = CapsuleEndoscopy + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[11]) {
                                Peg = Peg + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[12] || procedure_name == Gastro[13] || procedure_name == Gastro[14]) {
                                GastroVaricealHemoPlusLigation = GastroVaricealHemoPlusLigation + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[15]) {
                                LiverBiopsy = LiverBiopsy + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[16] || procedure_name == Gastro[17]) {
                                EsophagealDilatationPlusLuminalStenting = EsophagealDilatationPlusLuminalStenting + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[18]) {
                                EmrPlusEsd = EmrPlusEsd + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[19]) {
                                Ercp = Ercp + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[20]) {
                                EndoscopicUltrasound = EndoscopicUltrasound + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                            if (procedure_name == Gastro[21]) {
                                EsophagealMotilityPlusPh = EsophagealMotilityPlusPh + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                        }

                    // GASTRO COMPLIANCE CHECK

                        // check GastroOGDPlusGastroOGDWithBiopsy compliance
                        if (GastroOGDPlusGastroOGDWithBiopsy >= 300) { 
                            GastroOGDPlusGastroOGDWithBiopsy = true
                        }

                        // check GastroOGDPlusColon compliance
                        additionalCheckGastroOGDPlusColon = 0
                        for (var i = 0; i < chartData.data.data['procedure_logs'].length; i++) {
                            procedure_name = chartData.data.data['procedure_logs'][i]['Procedure_Name']
                            if (procedure_name == Gastro[3] || procedure_name == Gastro[5]) {
                                additionalCheckGastroOGDPlusColon = additionalCheckGastroOGDPlusColon + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                        }
                        //check GastroOGDPlusColon's additional requirement
                        if (additionalCheckGastroOGDPlusColon >= 10 && GastroOGDPlusColon >= 20) {
                            GastroOGDPlusColon = true
                        }
                        
                        // check ColonoscopyPlusColonoscopyWithBiopsy compliance
                        if (ColonoscopyPlusColonoscopyWithBiopsy >= 180) { 
                            ColonoscopyPlusColonoscopyWithBiopsy = true
                        }

                        // check ColonoscopyWithPolypectomy compliance
                        if (ColonoscopyWithPolypectomy >= 20) { 
                            ColonoscopyWithPolypectomy = true
                        }                    

                        // check AbdominalParacentesis compliance
                        if (AbdominalParacentesis >= 10) { 
                            AbdominalParacentesis = true
                        }   
                        
                        // check CapsuleEndoscopy compliance
                        if (CapsuleEndoscopy >= 10) { 
                            CapsuleEndoscopy = true
                        }              

                        // check Peg compliance
                        if (Peg >= 5) { 
                            Peg = true
                        }         

                        // check GastroVaricealHemoPlusLigation compliance
                        additionalCheckGastroVaricealHemoPlusLigation = 0
                        for (var i = 0; i < chartData.data.data['procedure_logs'].length; i++) {
                            procedure_name = chartData.data.data['procedure_logs'][i]['Procedure_Name']
                            if (procedure_name == Gastro[12]) {
                                additionalCheckGastroVaricealHemoPlusLigation = additionalCheckGastroVaricealHemoPlusLigation + parseInt(chartData.data.data['procedure_logs'][i]['Performed'])
                            }
                        }
                        //check GastroVaricealHemoPlusLigation's additional requirement
                        if (additionalCheckGastroVaricealHemoPlusLigation >= 5 && GastroVaricealHemoPlusLigation >= 20) {
                            GastroVaricealHemoPlusLigation = true
                        }
                        
                        // check LiverBiopsy compliance
                        if (LiverBiopsy >= 5) { 
                            LiverBiopsy = true
                        }    
                        
                        // check EsophagealDilatationPlusLuminalStenting compliance
                        if (EsophagealDilatationPlusLuminalStenting >= 5) { 
                            EsophagealDilatationPlusLuminalStenting = true
                        }       
                        
                        // check EmrPlusEsd compliance
                        if (EmrPlusEsd >= 5) { 
                            EmrPlusEsd = true
                        }  
                        
                        // check Ercp compliance
                        if (Ercp >= 5) { 
                            Ercp = true
                        }       

                        // check EndoscopicUltrasound compliance
                        if (EndoscopicUltrasound >= 5) { 
                            EndoscopicUltrasound = true
                        }       
                        
                        // check EsophagealMotilityPlusPh compliance
                        if (EsophagealMotilityPlusPh >= 5) { 
                            EsophagealMotilityPlusPh = true
                        }            

                        
                    // PUSHING DATA INTO CHART

                        // push GastroOGDPlusGastroOGDWithBiopsy data into chart
                        if (GastroOGDPlusGastroOGDWithBiopsy == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(GastroOGDPlusGastroOGDWithBiopsy/300)
                            this.ChartConfig.datasets[0].data.push(GastroOGDPlusGastroOGDWithBiopsy/300)
                        }

                        // push GastroOGDPlusColon data into chart
                        if (GastroOGDPlusColon == true) {

                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            // if not compliant due to active bleeders
                            if (additionalCheckGastroOGDPlusColon < 10 && GastroOGDPlusColon >= 20) {
                                this.ChartConfig.datasets[0].data.push(1)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroOGDPlusColon/10)  
                                this.ChartConfig.datasets[0].data.push(1)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroOGDPlusColon/10)  
                            }
                            // if not compliant due to total number required
                            else if (additionalCheckGastroOGDPlusColon >= 10 && GastroOGDPlusColon < 20) {
                                this.ChartConfig.datasets[0].data.push(GastroOGDPlusColon/20)  
                                this.ChartConfig.datasets[0].data.push(1)  
                                this.ChartConfig.datasets[0].data.push(GastroOGDPlusColon/20)  
                                this.ChartConfig.datasets[0].data.push(1)   
                            }
                            // if not compliant due to both
                            else if (additionalCheckGastroOGDPlusColon < 10 && GastroOGDPlusColon < 20) {                                
                                this.ChartConfig.datasets[0].data.push(GastroOGDPlusColon/20)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroOGDPlusColon/10)  
                                this.ChartConfig.datasets[0].data.push(GastroOGDPlusColon/20)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroOGDPlusColon/10)   
                            }
                        }

                        // push ColonoscopyPlusColonoscopyWithBiopsy data into chart
                        if (ColonoscopyPlusColonoscopyWithBiopsy == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(ColonoscopyPlusColonoscopyWithBiopsy/180)
                            this.ChartConfig.datasets[0].data.push(ColonoscopyPlusColonoscopyWithBiopsy/180)
                        }

                        // push ColonoscopyWithPolypectomy data into chart
                        if (ColonoscopyWithPolypectomy == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                            
                            this.ChartConfig.datasets[0].data.push(ColonoscopyWithPolypectomy/20)
                        }

                        // push AbdominalParacentesis data into chart
                        if (AbdominalParacentesis == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(AbdominalParacentesis/10)
                        }     

                        // push CapsuleEndoscopy data into chart
                        if (CapsuleEndoscopy == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(CapsuleEndoscopy/10)
                        }   
                
                        // push Peg data into chart
                        if (Peg == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                            
                            this.ChartConfig.datasets[0].data.push(Peg/5)
                        }   
                        
                        // push GastroVaricealHemoPlusLigation data into chart
                        if (GastroVaricealHemoPlusLigation == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            // if not compliant due to active bleeders
                            if (additionalCheckGastroVaricealHemoPlusLigation < 5 && GastroVaricealHemoPlusLigation >= 20) {                                
                                this.ChartConfig.datasets[0].data.push(1)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroVaricealHemoPlusLigation/5)  
                                this.ChartConfig.datasets[0].data.push(1)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroVaricealHemoPlusLigation/5)  
                            }
                            // if not compliant due to total number required
                            else if (additionalCheckGastroVaricealHemoPlusLigation >= 5 && GastroVaricealHemoPlusLigation < 20) {                                
                                this.ChartConfig.datasets[0].data.push(GastroVaricealHemoPlusLigation/20)  
                                this.ChartConfig.datasets[0].data.push(1)  
                                this.ChartConfig.datasets[0].data.push(GastroVaricealHemoPlusLigation/20)  
                                this.ChartConfig.datasets[0].data.push(1)   
                            }
                            // if not compliant due to both
                            else if (additionalCheckGastroVaricealHemoPlusLigation < 5 && GastroVaricealHemoPlusLigation < 20) {                               
                                this.ChartConfig.datasets[0].data.push(GastroVaricealHemoPlusLigation/20)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroVaricealHemoPlusLigation/5)  
                                this.ChartConfig.datasets[0].data.push(GastroVaricealHemoPlusLigation/20)  
                                this.ChartConfig.datasets[0].data.push(additionalCheckGastroVaricealHemoPlusLigation/5)   
                            }
                        }
                        
                        // push Peg data into chart
                        if (LiverBiopsy == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(LiverBiopsy/5)
                        }   
                        
                        // push EsophagealDilatationPlusLuminalStenting data into chart
                        if (EsophagealDilatationPlusLuminalStenting == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(EsophagealDilatationPlusLuminalStenting/5)
                            this.ChartConfig.datasets[0].data.push(EsophagealDilatationPlusLuminalStenting/5)
                        }
                        
                        // push EmrPlusEsd data into chart
                        if (EmrPlusEsd == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                            
                            this.ChartConfig.datasets[0].data.push(EmrPlusEsd/5)
                        }   
                        
                        // push Ercp data into chart
                        if (Ercp == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                            
                            this.ChartConfig.datasets[0].data.push(Ercp/5)
                        }         
                        
                        // push EndoscopicUltrasound data into chart
                        if (EndoscopicUltrasound == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(EndoscopicUltrasound/5)
                        }     
                        
                        // push EsophagealMotilityPlusPh data into chart
                        if (EsophagealMotilityPlusPh == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {                           
                            this.ChartConfig.datasets[0].data.push(EsophagealMotilityPlusPh/5)
                        }      

                    }

                    if (chartData.data.data['personaldetails']['Programme'] == "Renal Medicine") {

                    }

                    if (chartData.data.data['personaldetails']['Programme'] == "Internal Medicine") {

                        const Internal = ["Abdominal Tap", "Arterial Line Placement", "Central Line Placement", "Thoracentesis / Chest tube", "Lumbar Puncture", "Endotracheal Intubation", "Ventilator Management", "Arthrocentesis", "Hemodialysis Catheter Insertion", "ABG", "Vene", "IV Plug", "Ecg"]
                        this.ChartConfig.labels = Internal

                        AbdominalTap = 0
                        ArterialLinePlacement = 0
                        CentralLinePlacement = 0
                        ThoracentesisChestTube = 0
                        LumbarPuncture = 0
                        EndotrachealIntubation = 0
                        VentilatorManagement = 0
                        Arthrocentesis = 0
                        HemodialysisCatheterInsertion = 0
                        Abg = 0
                        Vene = 0
                        IVPlug = 0
                        Ecg = 0

                        // to be used to check requirements regarding R1:30%, R2:50% and R3:100% in the future
                        totalNumOfProceduresRequirements = 40
                        totalNumOfProceduresDoneByResident = 0

                        chartData.data.data['procedure_logs']

                    // POPULATING VARIABLES USING INFO FROM DATABASE

                        // for every procedure log entry
                        for (var i = 0; i < chartData.data.data['procedure_logs'].length; i++) {
                            procedure_name = chartData.data.data['procedure_logs'][i]['Procedure_Name']
                            if (procedure_name == Internal[0]) {
                                AbdominalTap = AbdominalTap + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[1]) {
                                ArterialLinePlacement = ArterialLinePlacement + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[2]) {
                                CentralLinePlacement = CentralLinePlacement + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[3]) {
                                ThoracentesisChestTube = ThoracentesisChestTube + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[4]) {
                                LumbarPuncture = LumbarPuncture + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[5]) {
                                EndotrachealIntubation = EndotrachealIntubation + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[6]) {
                                VentilatorManagement = VentilatorManagement + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[7]) {
                                Arthrocentesis = Arthrocentesis + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[8]) {
                                HemodialysisCatheterInsertion = HemodialysisCatheterInsertion + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[9]) {
                                Abg = Abg + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[10]) {
                                Vene = Vene + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[11]) {
                                IVPlug = IVPlug + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                            if (procedure_name == Internal[12]) {
                                Ecg = Ecg + parseInt(chartData.data.data['procedure_logs'][i]['Verified'])
                            }
                        }

                        totalNumOfProceduresDoneByResident = AbdominalTap + ArterialLinePlacement + CentralLinePlacement + ThoracentesisChestTube + LumbarPuncture + EndotrachealIntubation + VentilatorManagement + Arthrocentesis + HemodialysisCatheterInsertion + Abg + Vene + IVPlug + Ecg

                    // CHECK INTERNAL COMPLIANCE

                        // check AbdominalTap compliance
                        if (AbdominalTap >= 3) { 
                            AbdominalTap = true
                        }

                        // check ArterialLinePlacement compliance
                        if (ArterialLinePlacement >= 5) { 
                            ArterialLinePlacement = true
                        }                    

                        // check CentralLinePlacement compliance
                        if (CentralLinePlacement >= 5) { 
                            CentralLinePlacement = true
                        }   
                        
                        // check ThoracentesisChestTube compliance
                        if (ThoracentesisChestTube >= 3) { 
                            ThoracentesisChestTube = true
                        }              

                        // check LumbarPuncture compliance
                        if (LumbarPuncture >= 5) { 
                            LumbarPuncture = true
                        }         

                        // check EndotrachealIntubation compliance
                        if (EndotrachealIntubation >= 5) { 
                            EndotrachealIntubation = true
                        }   
      
                        // check VentilatorManagement compliance
                        if (VentilatorManagement >= 5) { 
                            VentilatorManagement = true
                        }   

                        // check Arthrocentesis compliance
                        if (Arthrocentesis >= 2) { 
                            Arthrocentesis = true
                        }   

                        // check HemodialysisCatheterInsertion compliance
                        if (HemodialysisCatheterInsertion >= 3) { 
                            HemodialysisCatheterInsertion = true
                        }   

                        // check Abg compliance
                        if (Abg >= 1) { 
                            Abg = true
                        }   

                        // check Vene compliance
                        if (Vene >= 1) { 
                            Vene = true
                        } 
            
                        // check IVPlug compliance
                        if (IVPlug >= 1) { 
                            IVPlug = true
                        }   

                        // check Ecg compliance
                        if (Ecg >= 1) { 
                            Ecg = true
                        }                           

                    // PUSHING DATA INTO CHART

                        // push AbdominalTap data into chart
                        if (AbdominalTap == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(AbdominalTap/3)
                        }

                        // push ArterialLinePlacement data into chart
                        if (ArterialLinePlacement == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(ArterialLinePlacement/5)
                        }

                        // push CentralLinePlacement data into chart
                        if (CentralLinePlacement == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(CentralLinePlacement/5)
                        }

                        // push ThoracentesisChestTube data into chart
                        if (ThoracentesisChestTube == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(ThoracentesisChestTube/3)
                        }

                        // push LumbarPuncture data into chart
                        if (LumbarPuncture == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(LumbarPuncture/5)
                        }

                        // push EndotrachealIntubation data into chart
                        if (EndotrachealIntubation == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(EndotrachealIntubation/5)
                        }

                        // push VentilatorManagement data into chart
                        if (VentilatorManagement == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(VentilatorManagement/5)
                        }

                        // push Arthrocentesis data into chart
                        if (Arthrocentesis == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(Arthrocentesis/2)
                        }

                        // push HemodialysisCatheterInsertion data into chart
                        if (HemodialysisCatheterInsertion == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(HemodialysisCatheterInsertion/3)
                        }

                        // push Abg data into chart
                        if (Abg == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(0)
                        }

                        // push Vene data into chart
                        if (Vene == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(0)
                        }

                        // push IVPlug data into chart
                        if (IVPlug == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(0)
                        }

                        // push Ecg data into chart
                        if (Ecg == true) {
                            this.ChartConfig.datasets[0].data.push(1)
                        }
                        else {
                            this.ChartConfig.datasets[0].data.push(0)
                        }

                    }

                }
            }
        });
        
    </script>
</body>

</html>